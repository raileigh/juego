<!DOCTYPE html>
<html>
<head>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<meta charset="UTF-8">
	<script
	src="https://code.jquery.com/jquery-3.2.1.js"
	integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
	crossorigin="anonymous"></script>
	<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
	<style type="text/css">
		
		.visible{

			display:block;

		}

		.oculto{

			display:none;

		}

		.atras_capa {
			background-color: rgb(246,246,246);
			opacity: 0.8;
			margin-top:2%;
			margin-left:10%;
			margin-right: 10%;
			padding-top:100%;
			position: relative;
			border-radius: 30px;
			z-index: 1;
			
		}

		.enfrente_capa {
			margin-top:-120%;
			opacity: 1;
			position: relative;
			z-index: -1;
		}

	</style>
	<title>JUEGO</title>
</head>
<body background="imagenes/fondo3d.jpg" width="30" height="50">
	<div class="atras_capa">
		<div class="enfrente_capa">
			<div class= "visible">
				<form id="formulario" class= "col-xs-12"> 
					<div style="padding-top:5%;padding-left: 32%; text-align:center" class= "col-xs-8" >
						<input type="text" class="form-control" placeholder="INTRODUCE TU NOMBRE DE HEROE" style="text-align:center">
						<button  id="botonNombre" class="btn btn-default" type="submit" value="Aceptar" style="margin-top:5%; text-align:center">Enviar</button>
					</div>
				</form>
			</div>
			<!--CAPA INVENTARIO -->
			<div class="col-xs-12" style="text-align: center; padding-top: 10%; font-weight: bold;">
				<div class="col-xs-12">
					<div class="col-xs-6">
						<div id="datosHeroe" class= "oculto">
							<div class="panel panel-default">
								<div class="panel-heading">
									<h3 class="panel-title">SOY SIR <span id="nombreHeroe"></span></h3>
								</div>
								<div class="panel-body"><img src="imagenes/helmet.png" style="padding-top: 1%">
								<br>
								<ul style="padding-top: 2%; padding-right: 3%">
										<li id="vidaHeroe" style="list-style: none; padding-right: 9%"></li>
										<li id="ataqueHeroe"  style="list-style: none; padding-right: 9%"></li>
										<li id="defensaHeroe"  style="list-style: none; padding-right: 9%"></li>
										<li id="oroHeroe"  style="list-style: none; padding-right: 9%"></li>
									</ul>
								</div>
							</div>
						</div>
					</div>
					<div>
						<div class="col-xs-6">
							<div id="datosMonstruo" class= "oculto"><span id="nombreMonstruo"></span>
								<div class="panel panel-default">
									<div class="panel-heading">
										<h3 class="panel-title" >¡ÉSTE ES TU FINAL!</h3>
									</div>
									<div class="panel-body" style="padding-top: 18px"><img src="imagenes/monster.png">
										<ul style="padding-top: 2%; padding-right: 38px">
											<li id="vidaMonstruo" style="list-style: none"></li>
											<li id="ataqueMonstruo" style="list-style: none"></li>
											<li id="defensaMonstruo" style="list-style: none"></li>
											<li id="oroMonstruo" style="list-style: none"></li>
										</ul>
									</div>
								</div>
								<br>
								<br>
								<br>
							</div>
							<div id="cuerda" class="oculto">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title" >¡DEMONIOS!</h3>
							</div>
							<div class="panel-body" style="padding-top: 53px"><img src="imagenes/rope.png"></div>
						</div>
					</div>
					<div id="cofre" class="oculto">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title" >¡ODÍN, DAME SUERTE!</h3>
							</div>
							<div class="panel-body" style="padding-top: 53px"><img src="imagenes/chest.png"></div>
						</div>
					</div>
					<div id="escaleras" class="oculto">
						<div class="panel panel-default">
							<div class="panel-heading">
								<h3 class="panel-title" >¿A DÓNDE CONDUCIRÁ?</h3>
							</div>
							<div class="panel-body" style="padding-top: 53px"><img src="imagenes/ladder.png"></div>
						</div>
					</div>
					</div>
					</div>
				</div>
				<div class="col-xs-12">
					<div id="grupoBoton" class= "oculto">
						<button id="luchar" class="btn btn-default" style="margin-left:45%">Luchar</button>
						<button id="comprar" class="btn btn-default" style="margin-left:42%; margin-top: 8px">Comprar Pócima</button>
					</div>
					<br>
					<div id="eventos"></div>
					<div id="gameOver" class="oculto">
						<H1>FIN DEL JUEGO</H1>
					</div>
					<div id="avanzar" class="oculto">
						<H1>SUPERAS AL MONSTRUO Y SIGUES HACIA ADELANTE</H1>
					</div>
					<div id="seguir" class= "oculto">
						<br>
						<button id="next" class="btn btn-default" onClick="incrementar()" value="incrementar">Seguir</button>
					</div>
					<br>
					<br>
					<div id="pruebaSuperada" class="oculto">
					<div class="col-xs-8" style="padding-left: 33%">
					<div class="panel panel-default">
  						<div class="panel-heading">
    						<img src="imagenes/shield.png">...PRUEBAS SUPERADAS...<img src="imagenes/shield.png">
  						</div>
  						<div class="panel-body">
  							<div id="nivelazo"></div>
						</div>
					</div>
					</div>
					</div>
				</div>
				<script type="text/javascript">

					var heroe;
					var monstruo;
					var nivel;


					document.getElementById("botonNombre").addEventListener("click", function(event){

						event.preventDefault();

						$('#formulario').removeClass('visible');
						$('#formulario').addClass('oculto');

			// Hacemos set del nivel de inicio del juego
			var nivel = 3;
			setNivel(nivel);
			
			var nombre = $('#formulario input').val();
			$('#nombreHeroe').text(nombre);

			var heroe = generarHeroe();
			

			$('#vidaHeroe').text("Vida: "+heroe.vida);
			$('#ataqueHeroe').text("Ataque: "+heroe.ataque);
			$('#defensaHeroe').text("Defensa: "+heroe.defensa);
			$('#oroHeroe').text("Oro: "+heroe.oro);

			activarVistas(["datosHeroe","seguir"]);	

		});


					document.getElementById("luchar").addEventListener("click", function(){

						var heroe = getHeroe();
						var monstruo = getMonstruo();

						luchaHeroe(heroe,monstruo);
			//luchaMonstruo(monstruo,heroe);

			$('#vidaHeroe').text("Vida: "+heroe.vida);
			$('#ataqueHeroe').text("Ataque: "+heroe.ataque);
			$('#defensaHeroe').text("Defensa: "+heroe.defensa);
			$('#oroHeroe').text("Oro: "+heroe.oro);
			$('#vidaMonstruo').text("Vida: "+monstruo.vida);
			$('#ataqueMonstruo').text("Ataque: "+monstruo.ataque);
			$('#defensaMonstruo').text("Defensa: "+monstruo.defensa);
			$('#oroMonstruo').text("Oro: "+monstruo.oro);

			activarVistas(["datosHeroe","datosMonstruo","pruebaSuperada"]);	

		});
					var contador= 0-1;
					function incrementar(){
  					contador++;
  					document.getElementById("nivelazo").innerHTML = contador;
  					
  					}

					function generarHeroe(){
						heroe = {"vida":3,"ataque":3,"defensa":4,"oro":10};
						return heroe;
					}

					function getHeroe(){
						return heroe;
					}

					function getMonstruo(){
						return monstruo;
					}

					function generarMonstruo(nivelActual){
						monstruo = {
							"vida": generaRandom(1,nivelActual),
							"ataque":generaRandom(1,nivelActual),
							"defensa":generaRandom(1,nivelActual),
							"oro":generaRandom(1,nivelActual)
						};
						return monstruo;
					}

					function setNivel(nuevoNivel){
						nivel = nuevoNivel;
					}

					function getNivel(){
						return nivel;
					}


					function luchaHeroe(heroe,monstruo){

			// Ataque Heroe
			var defensaMonstruo = monstruo.defensa - (heroe.ataque+generaRandom(1,6));

			if (defensaMonstruo <0){

				var danio = defensaMonstruo;
				monstruo.vida = monstruo.vida + danio;

			}


			// Ataque Monstruo 

			var defensaHeroe = heroe.defensa - (monstruo.ataque+generaRandom(1,6));

			if (defensaHeroe <0){

				var danio = defensaHeroe;
				heroe.vida = heroe.vida + danio;


			}

			///////////////////////////////CONDICIÓN PARA OBTENER ORO DEL MONSTRUO///////////////////////////////////

			var oroMonstruo = monstruo.oro;

			if( monstruo.vida<=0 && heroe.vida>0){
				
				var oro = oroMonstruo;
				heroe.oro = heroe.oro + oro;
				monstruo.oro = monstruo.oro - oro;


			}


			if( heroe.vida<=0){
				
				$('#eventos').text("¡¡¡Has muerto!!!");
				activarVistas(['gameOver']);
				desactivarVistas(["datosHeroe","datosMonstruo","grupoBoton"]);
			}

			// Este bloque hay que hacerlo para el monstruo

			if( monstruo.vida<=0){
				desactivarVistas(["grupoBoton"]);
				activarVistas(["avanzar","seguir","pruebaSuperada"]);
			}

			// si los dos mueren

			if( monstruo.vida<=0 && heroe.vida<=0){

				desactivarVistas(["avanzar","grupoBoton","seguir"]);
				activarVistas(['gameOver']);
			}
		}

		function generarTesoro(heroe,nivelActual){

			var item = generaRandom(1,10);
			
			if(item >=1 && item <=2){

				var oro = generaRandom(0,nivelActual);
				heroe.oro = heroe.oro + oro;
				
				setTimeout(function(){
					$('#eventos').text("Encuentras una bolsa con "+oro+ " de oro");
					heroe.oro = heroe.oro + oro;
					desactivarVistas(['datosMonstruo']);
					activarVistas(['seguir']);
				},3000);
			}else if(item >=3 && item <=5){

				var vida =generaRandom(0,nivelActual);
				heroe.vida = heroe.vida + vida;
				
				setTimeout(function(){
					$('#eventos').text("Encuentras una pocion de "+vida+ " de vida");
					heroe.vida = heroe.vida + vida;
					activarVistas(['seguir']);
					desactivarVistas(['datosMonstruo']);
				},3000);
			}else{

				setTimeout(function(){
					$('#eventos').text("Encuentras un cofre lleno de telarañas");
					activarVistas(['seguir']);
					desactivarVistas(['datosMonstruo']);
					
				},3000);
			}

			return heroe;

		}

		function generarTrampa(){
			var nivelTrampa = generaRandom(1,3);
			switch(nivelTrampa){
				case 1:
				danioTrampa = generaRandom(1,3);
				break;

				case 2:
				danioTrampa = generaRandom(4,8);
				break;
				case 3:
				danioTrampa = generaRandom(9,10);
				break;

				default:
				danioTrampa = 5;
			}

			return danioTrampa;
		}

		function subirEscalera(nivelActual){
			setNivel(nivelActual+1);
		}

		function generaRandom(min,max){
			max=max + 1;
			var numeroAleatorio = Math.floor((Math.random() * (max-min)+min));
			return numeroAleatorio;
		}

		function activarVistas(vistas){
			$.each(vistas,function(index,value){
				$('#'+ value).removeClass('oculto');
				$('#'+value).addClass("visible");	
			});
		}

		function desactivarVistas(vistas){
			$.each(vistas,function(index,value){
				$('#'+ value).removeClass('visible');
				$('#'+value).addClass("oculto");
			});
		}

		// cuando le damos al botón seguir una vez derrotado al monstruo y salir victoriosos///////////////////

		document.getElementById("next").addEventListener("click", function(event){

			var tiradaDado = generaRandom(1,20);

			if(tiradaDado >=0 && tiradaDado <=9){

				$('#eventos').text("Te has encontrado con un monstruo");

				var monstruo = generarMonstruo(getNivel());

				$('#vidaMonstruo').text("Vida: "+monstruo.vida);
				$('#ataqueMonstruo').text("Ataque: "+monstruo.ataque);
				$('#defensaMonstruo').text("Defensa: "+monstruo.defensa);
				$('#oroMonstruo').text("Oro: "+monstruo.oro);

				activarVistas(['grupoBoton']);
				desactivarVistas(['escaleras',"cuerda","cofre"]);

				if( monstruo.vida<=0 && heroe.vida>0){
					desactivarVistas(["avanzar","eventos","grupoBoton","cuerda","escaleras","cofre"])
					activarVistas(["seguir","pruebaSuperada"]);
				}

			}else if (tiradaDado >=10 && tiradaDado<=15){

				var danioTrampa = generarTrampa();
				
				$('#eventos').text("¡¡¡Has caido en una trampa!!!");
				activarVistas(["cuerda"]);
				desactivarVistas(['escaleras',"cofre","datosMonstruo"]);

				setTimeout(function(){
					$('#eventos').text("Has perdido : " + danioTrampa + " puntos de vida.");
					heroe.vida = heroe.vida - danioTrampa;

					$('#vidaHeroe').text("Vida: "+heroe.vida);
					
				}
				, 3000);// inyectar un carrusel de eventos para avisar lo que esta pasando al jugador

				setTimeout(function(){
					if(heroe.vida<=0){

						$('#eventos').text("¡¡¡Has muerto!!!");
						desactivarVistas([
							"avanzar",
							"seguir",
							"luchar",
							"comprar",
							"datosMonstruo"
							]);
						activarVistas(['gameOver',"pruebaSuperada"]);
					}else{
						activarVistas(['seguir',"pruebaSuperada"]);
					}
				}
				, 6000);

			}else if(tiradaDado >=16 && tiradaDado<19){

				$('#eventos').text("Has encontrado un misterioso cofre, ¿que tendrá?");
				activarVistas(["cofre"]);
				desactivarVistas(['escaleras',"cuerda","datosMonstruo"]);
				heroe = generarTesoro(heroe, getNivel());

				setTimeout(function(){
					activarVistas(['seguir',"pruebaSuperada"]);
					desactivarVistas(["datosMonstruo","grupoBoton"])
				}
				, 3000);
			}else if (tiradaDado >=19  && tiradaDado<=20){

				
				subirEscalera(getNivel());
				activarVistas(["escaleras","seguir","pruebaSuperada"]);
				desactivarVistas(["cuerda","cofre","datosMonstruo"]);
				var monstruo = generarMonstruo(getNivel());
				

				$('#eventos').text("Has encontrado una escalera, ten cuidado");
				$('#vidaMonstruo').text("Vida: "+monstruo.vida);
				$('#ataqueMonstruo').text("Ataque: "+monstruo.ataque);
				$('#defensaMonstruo').text("Defensa: "+monstruo.defensa);
				$('#oroMonstruo').text("Oro: "+monstruo.oro);


			}else if (tiradaDado <10 && tiradaDado>15){

				activarVistas(['comprar']);

			}else{

				document.write("Se ha producido un error en la aplicación, contacte con el administrador");

			}
			

			//console.log(monstruo);


			
			$('#vidaHeroe').text("Vida: "+heroe.vida);
			$('#ataqueHeroe').text("Ataque: "+heroe.ataque);
			$('#defensaHeroe').text("Defensa: "+heroe.defensa);
			$('#oroHeroe').text("Oro: "+heroe.oro);

			//estos casos son mientras se esta cargando el Timeout haga esto hasta la resolución del tiempo puesto.
			
			if(tiradaDado >=10 && tiradaDado<=15){

				desactivarVistas([
					"avanzar",
					"seguir",
					"luchar",
					"comprar",
					"escaleras",
					"cofre",
					"datosMonstruo"
					]);

				activarVistas([
					"cuerda",
					"pruebaSuperada"
					]);

			}else if(tiradaDado >=16 && tiradaDado<19){

				desactivarVistas([
					"avanzar",
					"seguir",
					"luchar",
					"comprar",
					"datosMonstruo",
					"escaleras",
					"cuerda"
					]);

				activarVistas([
					"cofre",
					"pruebaSuperada"
					]);

			}else if(tiradaDado >=19  && tiradaDado<=20){

				desactivarVistas([
					"avanzar",
					"luchar",
					"comprar",
					"cofre",
					"cuerda",
					"cofre",
					"datosMonstruo"
					]);

				activarVistas([
					
					"seguir",
					"pruebaSuperada"
					
					]);


			}else{

				desactivarVistas(['avanzar',"seguir"]);
				activarVistas([
					"datosHeroe",
					"datosMonstruo",	
					"luchar",
					"comprar",
					"pruebaSuperada"
					]);

			}

			});

		//Cuando le damos al botón comprar pócima///////////////////////////////////////////////////////

		document.getElementById("comprar").addEventListener("click", function(event){
			
			
			var pocion = generaRandom(1,3);
			heroe.vida = heroe.vida + pocion;
			$('#vidaHeroe').text("Vida: "+heroe.vida);
			
			var oroHeroe = heroe.oro;
			var costePocion = oroHeroe - 3;
			heroe.oro = costePocion;
			
			$('#oroHeroe').text("Oro: "+heroe.oro);

			if(heroe.oro<3){

				desactivarVistas(['comprar']);

			}

		});
	</script>
</div>
</div>
</div>
</body>
</html>
