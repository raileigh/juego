<!DOCTYPE html>
<html>
<head>
	<script
	src="https://code.jquery.com/jquery-3.2.1.js"
	integrity="sha256-DZAnKJ/6XZ9si04Hgrsxu/8s717jcIzLy3oi35EouyE="
	crossorigin="anonymous"></script>

	<style type="text/css">
		
		.visible{

			display:block;

		}

		.oculto{

			display:none;

		}


	</style>
	<title>JUEGO</title>
</head>
<body>
	<div class="visible">
		<form id="formulario"> 
			<label>INTRODUCE UN NOMBRE PARA TU HEROE</label>
			<input type="text" name="">
			<button id="botonNombre" type="submit" value="Aceptar">Enviar</button>
		</form>
	</div>
	<!--CAPA INVENTARIO -->
	<div id="datosHeroe" class= "oculto"> <span id="nombreHeroe"></span>

		<ul>
			<li id="vidaHeroe"></li>
			<li id="ataqueHeroe"></li>
			<li id="defensaHeroe"></li>
			<li id="oroHeroe"></li>
		</ul>

	</div>
	<div id="datosMonstruo" class= "oculto"> <span id="nombreMonstruo"></span>

		<ul>
			<li id="vidaMonstruo"></li>
			<li id="ataqueMonstruo"></li>
			<li id="defensaMonstruo"></li>
			<li id="oroMonstruo"></li>
		</ul>
		<button id="luchar">Luchar</button>
		<button id="comprar">Comprar Pócima</button>
	</div>
	<div id="eventos"></div>
	<div id="gameOver" class="oculto">

		<H1>FIN DEL JUEGO</H1>
	</div>
	<div id="avanzar" class="oculto">

		<H1>SUPERAS AL MONSTRUO Y SIGUES HACIA ADELANTE</H1>
	</div>
	<div id="seguir" class= "oculto">
		<button id="next">Seguir</button>
	</div>

	<script type="text/javascript">

		var heroe;
		var monstruo;
		var nivel;


		document.getElementById("botonNombre").addEventListener("click", function(event){

			event.preventDefault();

			$('#formulario').removeClass('visible');
			$('#formulario').addClass('oculto');

			// Hacemos set del nivel de inicio del juego
			var nivel = 3;
			setNivel(nivel);
			
			var nombre = $('#formulario input').val();
			$('#nombreHeroe').text(nombre);

			var heroe = generarHeroe();
			

			$('#vidaHeroe').text("Vida: "+heroe.vida);
			$('#ataqueHeroe').text("Ataque: "+heroe.ataque);
			$('#defensaHeroe').text("Defensa: "+heroe.defensa);
			$('#oroHeroe').text("Oro: "+heroe.oro);
			
			activarVista('datosHeroe');
			activarVista('seguir');

		});


		document.getElementById("luchar").addEventListener("click", function(){

			var heroe = getHeroe();
			var monstruo = getMonstruo();

			luchaHeroe(heroe,monstruo);
			//luchaMonstruo(monstruo,heroe);

			$('#vidaHeroe').text("Vida: "+heroe.vida);
			$('#ataqueHeroe').text("Ataque: "+heroe.ataque);
			$('#defensaHeroe').text("Defensa: "+heroe.defensa);
			$('#oroHeroe').text("Oro: "+heroe.oro);
			$('#vidaMonstruo').text("Vida: "+monstruo.vida);
			$('#ataqueMonstruo').text("Ataque: "+monstruo.ataque);
			$('#defensaMonstruo').text("Defensa: "+monstruo.defensa);
			$('#oroMonstruo').text("Oro: "+monstruo.oro);

			activarVista('datosHeroe');
			activarVista('datosMonstruo');


		});

		function generarHeroe(){
			heroe = {"vida":3,"ataque":3,"defensa":4,"oro":10};
			return heroe;
		}

		function getHeroe(){
			return heroe;
		}

		function getMonstruo(){
			return monstruo;
		}

		function generarMonstruo(nivelActual){
			monstruo = {
				"vida": generaRandom(1,nivelActual),
				"ataque":generaRandom(1,nivelActual),
				"defensa":generaRandom(1,nivelActual),
				"oro":generaRandom(1,nivelActual)
			};
			return monstruo;
		}
		
		function setNivel(nuevoNivel){
			nivel = nuevoNivel;
		}
		
		function getNivel(){
			return nivel;
		}


		function luchaHeroe(heroe,monstruo){

			// Ataque Heroe
			var defensaMonstruo = monstruo.defensa - (heroe.ataque+generaRandom(1,6));

			if (defensaMonstruo <0){

				var danio = defensaMonstruo;
				monstruo.vida = monstruo.vida + danio;

			}


			// Ataque Monstruo 

			var defensaHeroe = heroe.defensa - (monstruo.ataque+generaRandom(1,6));

			if (defensaHeroe <0){

				var danio = defensaHeroe;
				heroe.vida = heroe.vida + danio;


			}

			///////////////////////////////CONDICIÓN PARA OBTENER ORO DEL MONSTRUO///////////////////////////////////

			var oroMonstruo = monstruo.oro;

			if( monstruo.vida<=0 && heroe.vida>0){
				
				var oro = oroMonstruo;
				heroe.oro = heroe.oro + oro;
				monstruo.oro = monstruo.oro - oro;

			}


			if( heroe.vida<=0){
				activarVista('gameOver');
				desactivarVista('datosHeroe');
				desactivarVista('datosMonstruo');

				desactivarVista('luchar');
				desactivarVista('comprar');

			}

			// Este bloque hay que hacerlo para el monstruo

			if( monstruo.vida<=0){
				activarVista('avanzar');

				desactivarVista('luchar');
				desactivarVista('comprar');
				activarVista('seguir');

			}

			// si los dos mueren

			if( monstruo.vida<=0 && heroe.vida<=0){

				activarVista('gameOver');

				desactivarVista('avanzar');
				desactivarVista('luchar');
				desactivarVista('comprar');
				desactivarVista('seguir');

			}
		}

		function generarTesoro(heroe,nivelActual){

			var item = generaRandom(1,10);
			
			if(item >=1 && item <=2){

				var oro = generaRandom(0,nivelActual);
				heroe.oro = heroe.oro + oro;
				
				setTimeout(function(){
					$('#eventos').text("Encuentras una bolsa con "+oro+ " de oro");
					heroe.oro = heroe.oro + oro;
					activarVista('seguir');
					desactivarVista('datosMonstruo');
				},3000);
			}else if(item >=3 && item <=5){

				var vida =generaRandom(0,nivelActual);
				heroe.vida = heroe.vida + vida;
				
				setTimeout(function(){
					$('#eventos').text("Encuentras una pocion de "+vida+ " de vida");
					heroe.vida = heroe.vida + vida;
					activarVista('seguir');
					desactivarVista('datosMonstruo');
				},3000);
			}else{

				setTimeout(function(){
					$('#eventos').text("Encuentras un cofre lleno de telarañas");
					activarVista('seguir');
					desactivarVista('datosMonstruo');
					
				},3000);
			}

			return heroe;

		}

		function generarTrampa(){
			var nivelTrampa = generaRandom(1,3);
			switch(nivelTrampa){
				case 1:
				danioTrampa = generaRandom(1,3);
				break;

				case 2:
				danioTrampa = generaRandom(4,8);
				break;
				case 3:
				danioTrampa = generaRandom(9,10);
				break;

				default:
				danioTrampa = 5;
			}

			return danioTrampa;
		}

		function subirEscalera(nivelActual){
			setNivel(nivelActual+1);
		}

		function generaRandom(min,max){
			max=max + 1;
			var numeroAleatorio = Math.floor((Math.random() * (max-min)+min));
			return numeroAleatorio;
		}

		function activarVista(id){

			$('#'+ id).removeClass('oculto');
			$('#'+id).addClass("visible");

		}

		function desactivarVista(id){

			$('#'+ id).removeClass('visible');
			$('#'+id).addClass("oculto");

		}

		// cuando le damos al botón seguir una vez derrotado al monstruo y salir victoriosos///////////////////

		document.getElementById("next").addEventListener("click", function(event){
			
			
			var tiradaDado = generaRandom(1,20);

			if(tiradaDado >=0 && tiradaDado <=9){

				$('#eventos').text("Te has encontrado con un monstruo");
				var monstruo = generarMonstruo(getNivel());
				console.log(monstruo);

				$('#vidaMonstruo').text("Vida: "+monstruo.vida);
				$('#ataqueMonstruo').text("Ataque: "+monstruo.ataque);
				$('#defensaMonstruo').text("Defensa: "+monstruo.defensa);
				$('#oroMonstruo').text("Oro: "+monstruo.oro);

				activarVista('luchar');
				activarVista('comprar')

			}else if (tiradaDado >=10 && tiradaDado<=15){

				var danioTrampa = generarTrampa();
				$('#eventos').text("¡¡¡Has caido en una trampa!!!");

				setTimeout(function(){
					$('#eventos').text("Has perdido : " + danioTrampa + " puntos de vida.");
					heroe.vida = heroe.vida - danioTrampa;
					activarVista('seguir');


					if(heroe.vida<=0){

						$('#eventos').text("¡¡¡Has muerto!!!");
						activarVista('gameOver');
						desactivarVista('datosMonstruo');
						desactivarVista('luchar');
						desactivarVista('comprar');
						desactivarVista('seguir');
					}

					$('#vidaHeroe').text("Vida: "+heroe.vida);
				}
				, 3000);// inyectar un carrusel de eventos para avisar lo que esta pasando al jugador
				

			}else if(tiradaDado >=16 && tiradaDado<=19){

				$('#eventos').text("Has encontrado un misterioso cofre, ¿que tendrá?");
				heroe = generarTesoro(heroe, getNivel());

				desactivarVista('comprar');	
				desactivarVista('luchar');
				activarVista('seguir');


			}else if (tiradaDado = 20){

				subirEscalera(getNivel());
				var monstruo = generarMonstruo(getNivel());
				


				$('#vidaMonstruo').text("Vida: "+monstruo.vida);
				$('#ataqueMonstruo').text("Ataque: "+monstruo.ataque);
				$('#defensaMonstruo').text("Defensa: "+monstruo.defensa);
				$('#oroMonstruo').text("Oro: "+monstruo.oro);


			}else if (tiradaDado <10 && tiradaDado>15){

				activarVista('comprar');

			}else{

				document.write("Se ha producido un error en la aplicación, contacte con el administrador");

			}
			

			//console.log(monstruo);

		
			
			$('#vidaHeroe').text("Vida: "+heroe.vida);
			$('#ataqueHeroe').text("Ataque: "+heroe.ataque);
			$('#defensaHeroe').text("Defensa: "+heroe.defensa);
			$('#oroHeroe').text("Oro: "+heroe.oro);
			

			activarVista('datosHeroe');
			activarVista('datosMonstruo');

			desactivarVista('avanzar');
			activarVista('luchar');
			activarVista('comprar');
			desactivarVista('seguir');
			
	

		});

		//Cuando le damos al botón comprar pócima///////////////////////////////////////////////////////

		document.getElementById("comprar").addEventListener("click", function(event){
			
			
			var pocion = generaRandom(1,3);
			heroe.vida = heroe.vida + pocion;
			$('#vidaHeroe').text("Vida: "+heroe.vida);
			
			var oroHeroe = heroe.oro;
			var costePocion = oroHeroe - 3;
			heroe.oro = costePocion;
			
			$('#oroHeroe').text("Oro: "+heroe.oro);

			if(heroe.oro<3){

				desactivarVista('comprar');

			}

		});
	</script>
</body>
</html>
